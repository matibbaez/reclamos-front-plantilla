<div class="modal-backdrop" (click)="cerrarModal()"></div>

<div class="modal-sheet">
  
  <header class="sheet-header">
    <div class="header-top">
      <div>
        <h2 class="title">Expediente #{{ reclamo.codigo_seguimiento }}</h2>
        <p class="subtitle">{{ reclamo.tipo_tramite }} <span *ngIf="reclamo.subtipo_tramite">• {{ reclamo.subtipo_tramite }}</span></p>
      </div>
      <button class="btn-close" (click)="cerrarModal()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
    </div>

    <div class="sheet-tabs">
      <button class="tab-link" [class.active]="activeTab === 'info'" (click)="activeTab = 'info'">Información</button>
      <button class="tab-link" [class.active]="activeTab === 'archivos'" (click)="activeTab = 'archivos'">Documentación</button>
      <button class="tab-link" [class.active]="activeTab === 'gestion'" (click)="activeTab = 'gestion'">Estado</button>
    </div>
  </header>

  <div class="sheet-body">

    <div *ngIf="activeTab === 'info'" class="tab-content fade-in">
      
      <section class="info-section">
        <h3 class="section-title">Datos del Cliente</h3>
        <div class="info-grid">
          <div class="field">
            <label>Nombre Completo</label>
            <p>{{ reclamo.nombre }}</p>
          </div>
          <div class="field">
            <label>DNI</label>
            <p class="mono">{{ reclamo.dni }}</p>
          </div>
          <div class="field">
            <label>Email de Contacto</label>
            <p>{{ reclamo.email }}</p>
          </div>
          <div class="field">
            <label>Fecha Ingreso</label>
            <p>{{ reclamo.fecha_creacion | date:'dd/MM/yyyy HH:mm' }}</p>
          </div>
        </div>
      </section>

      <section class="info-section warning" *ngIf="reclamo.tipo_tramite === 'Rechazo'">
        <h3 class="section-title text-red">Detalle del Accidente (ART)</h3>
        
        <div class="info-grid">
          <div class="field">
            <label>Jornada Laboral</label>
            <p>{{ reclamo.jornada_laboral || '-' }}</p>
          </div>
          <div class="field">
            <label>Dirección Laboral</label>
            <p>{{ reclamo.direccion_laboral || '-' }}</p>
          </div>
        </div>
        
        <div class="field full">
          <label>Trayecto Habitual</label>
          <div class="text-box">
            {{ reclamo.trayecto_habitual || 'No especificado' }}
          </div>
        </div>
      </section>

      <div class="alert-box" *ngIf="reclamo.path_revoca_patrocinio">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" /></svg>
        <div>
          <strong>Atención: Revocación de Patrocinio</strong>
          <p>Este cliente adjuntó una carta para revocar abogado anterior.</p>
        </div>
      </div>

    </div>

    <div *ngIf="activeTab === 'archivos'" class="tab-content fade-in">
      <div class="files-grid">
        
        <div class="file-card" *ngIf="reclamo.path_dni">
          <div class="icon-file blue">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625Z" /><path d="M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z" /></svg>
          </div>
          <div class="file-info">
            <h4>DNI (Frente/Dorso)</h4>
            <button class="link-download" (click)="descargarArchivo('dni')" [disabled]="descargando === 'dni'">
              {{ descargando === 'dni' ? 'Descargando...' : 'Descargar PDF' }}
            </button>
          </div>
        </div>

        <div class="file-card" *ngIf="reclamo.path_recibo">
          <div class="icon-file green">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 7.47 7.47 0 0 1-3.522.877 7.47 7.47 0 0 1-3.522-.877.75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75Zm.75 4.5a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" /></svg>
          </div>
          <div class="file-info">
            <h4>Recibo de Sueldo</h4>
            <button class="link-download" (click)="descargarArchivo('recibo')" [disabled]="descargando === 'recibo'">
              {{ descargando === 'recibo' ? 'Descargando...' : 'Descargar PDF' }}
            </button>
          </div>
        </div>

        <div class="file-card alert" *ngIf="reclamo.path_carta_documento">
          <div class="icon-file orange">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875ZM12.75 12a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V18a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V12Z" clip-rule="evenodd" /></svg>
          </div>
          <div class="file-info">
            <h4>Carta Documento</h4>
            <button class="link-download" (click)="descargarArchivo('carta_documento')" [disabled]="descargando === 'carta_documento'">
              {{ descargando === 'carta_documento' ? 'Descargando...' : 'Descargar PDF' }}
            </button>
          </div>
        </div>

        <div class="file-card" *ngIf="reclamo.path_alta_medica">
          <div class="icon-file"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.237 8.237 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886V4.533ZM12.75 20.636A8.214 8.214 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.735 9.735 0 0 0 18 3a9.707 9.707 0 0 0-5.25 1.533v16.103Z" /></svg></div>
          <div class="file-info">
            <h4>Alta Médica</h4>
            <button class="link-download" (click)="descargarArchivo('alta')">Descargar</button>
          </div>
        </div>

      </div>
    </div>

    <div *ngIf="activeTab === 'gestion'" class="tab-content fade-in center-content">
      
      <div class="status-manager">
        <h3>Actualizar Estado del Trámite</h3>
        <p>Seleccioná el nuevo estado para este expediente. Esto enviará una notificación al cliente si está configurado.</p>

        <form [formGroup]="estadoForm" class="status-form">
          <div class="radio-group">
            
            <label class="radio-option" [class.selected]="estadoForm.get('estado')?.value === 'Recibido'">
              <input type="radio" formControlName="estado" value="Recibido">
              <span class="dot blue"></span>
              <div class="radio-text">
                <strong>Recibido</strong>
                <span>El trámite ingresó pero no se inició gestión.</span>
              </div>
            </label>

            <label class="radio-option" [class.selected]="estadoForm.get('estado')?.value === 'En Proceso'">
              <input type="radio" formControlName="estado" value="En Proceso">
              <span class="dot orange"></span>
              <div class="radio-text">
                <strong>En Proceso</strong>
                <span>Abogado asignado, trámite en curso.</span>
              </div>
            </label>

            <label class="radio-option" [class.selected]="estadoForm.get('estado')?.value === 'Finalizado'">
              <input type="radio" formControlName="estado" value="Finalizado">
              <span class="dot green"></span>
              <div class="radio-text">
                <strong>Finalizado</strong>
                <span>Trámite concluido o cerrado.</span>
              </div>
            </label>

          </div>
        </form>
      </div>

    </div>

  </div>

  <footer class="sheet-footer">
    <button class="btn-cancel" (click)="cerrarModal()">Cerrar sin cambios</button>
    <button class="btn-save" (click)="guardarCambios()" [disabled]="estadoForm.invalid || estadoForm.pristine">
      Guardar Cambios
    </button>
  </footer>

</div>