<div class="page-container">
  <app-card [titulo]="'Panel de Administración'">
    
    <div class="tools-bar">
      
      <button class="btn-filter-toggle" (click)="toggleFiltros()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
        </svg>
        {{ filtrosAbiertos ? 'Ocultar Filtros' : 'Filtrar Trámites' }}
      </button>

      <div class="filters-wrapper" [class.show-mobile]="filtrosAbiertos">
        
        <div class="status-tabs">
          <button class="tab-btn" [class.active]="filtroEstado === ''" (click)="cambiarEstado('')">Todos</button>
          <button class="tab-btn" [class.active]="filtroEstado === 'Recibido'" (click)="cambiarEstado('Recibido')">Recibidos</button>
          <button class="tab-btn" [class.active]="filtroEstado === 'En Proceso'" (click)="cambiarEstado('En Proceso')">En Proceso</button>
          <button class="tab-btn" [class.active]="filtroEstado === 'Finalizado'" (click)="cambiarEstado('Finalizado')">Finalizados</button>
        </div>

        <div class="filters-right">
          
          <div class="custom-select-wrapper">
            <select (change)="cambiarTipo($event)" class="custom-select">
              <option value="">Todos los Tipos</option>
              <option value="Revoca">Solo Revocaciones</option>
              <option value="Rechazo">Rechazos</option>
              <option value="Medico">Médicos (Dolor)</option>
              <option value="Incapacidad">Incapacidad (Cobrar)</option>
            </select>
            <div class="select-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
              </svg>
            </div>
          </div>

          <button class="btn-sort" (click)="alternarOrden()" [title]="ordenDescendente ? 'Ver más antiguos primero' : 'Ver más recientes primero'">
            <span class="sort-text">{{ ordenDescendente ? 'Más Recientes' : 'Más Antiguos' }}</span>
            <div class="sort-icon">
              <svg *ngIf="ordenDescendente" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0l-3.75-3.75M17.25 21L21 17.25" /></svg>
              <svg *ngIf="!ordenDescendente" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12" /></svg>
            </div>
          </button>

        </div>

      </div>
    </div>

    <div *ngIf="!loading; else loadingTemplate">
      
      <div class="table-responsive" *ngIf="reclamosFiltrados.length > 0; else noReclamos">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Código</th>
              <th>Cliente</th>
              <th>Trámite</th>
              <th>DNI</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reclamo of reclamosFiltrados" 
                [class.row-urgente]="reclamo.path_revoca_patrocinio">
              
              <td>{{ reclamo.fecha_creacion | date:'dd/MM' }}</td>
              
              <td class="font-mono font-bold">{{ reclamo.codigo_seguimiento }}</td>
              
              <td>
                <div class="cliente-info">
                  <span class="nombre">{{ reclamo.nombre }}</span>
                  <span class="email-chico">{{ reclamo.email }}</span>
                </div>
              </td>

              <td>
                <div class="tipo-wrapper">
                  <span class="tipo-main">
                    {{ reclamo.tipo_tramite }}
                    <span *ngIf="reclamo.subtipo_tramite" class="subtipo">({{ reclamo.subtipo_tramite }})</span>
                  </span>

                  <span *ngIf="reclamo.path_revoca_patrocinio" class="badge-pill red">
                    REVOCACIÓN
                  </span>
                </div>
              </td>

              <td>{{ reclamo.dni }}</td>
              
              <td>
                <span class="status-dot" [ngClass]="reclamo.estado.toLowerCase().replace(' ', '-')"></span>
                {{ reclamo.estado }}
              </td>

              <td>
                <button class="btn-icon" (click)="abrirModal(reclamo)" title="Gestionar">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noReclamos>
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="empty-icon">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3.267ul4.5 4.5m0-4.5l-4.5 4.5m-6-8.25h19.5a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-19.5A2.25 2.25 0 012.25 19.5v-9A2.25 2.25 0 014.5 7.5z" />
          </svg>
          <p>No se encontraron trámites con estos filtros.</p>
        </div>
      </ng-template>

    </div>

    <ng-template #loadingTemplate>
      <div class="loading-box">
        <div class="spinner"></div>
        <span>Cargando datos...</span>
      </div>
    </ng-template>

  </app-card>
</div>

<app-gestionar-reclamo-modal
  *ngIf="reclamoSeleccionado"
  [reclamo]="reclamoSeleccionado"
  (close)="cerrarModal()"
  (save)="guardarCambiosModal($event)"
></app-gestionar-reclamo-modal>