<div class="dashboard-container">
  
  <header class="dashboard-header">
    <div class="header-title">
      <h1>Gestión de Trámites</h1>
      <p class="subtitle">{{ reclamosFiltrados.length }} expedientes activos</p>
    </div>

    <div class="tools-bar">
      
      <div class="search-box">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Buscar por DNI o Apellido..." (input)="filtrarBusqueda($event)">
      </div>

      <div class="filters-desktop">
        
        <div class="status-pills">
          <button class="pill" [class.active]="filtroEstado === ''" (click)="cambiarEstado('')">Todos</button>
          <button class="pill" [class.active]="filtroEstado === 'Recibido'" (click)="cambiarEstado('Recibido')">Nuevos</button>
          <button class="pill" [class.active]="filtroEstado === 'En Proceso'" (click)="cambiarEstado('En Proceso')">En Curso</button>
          <button class="pill" [class.active]="filtroEstado === 'Finalizado'" (click)="cambiarEstado('Finalizado')">Cerrados</button>
        </div>

        <div class="custom-select">
          <select (change)="cambiarTipo($event)">
            <option value="">Todos los Tipos</option>
            <option value="Revoca">⚠️ Revocaciones</option>
            <option value="Rechazo">Rechazos ART</option>
            <option value="Medico">Médicos</option>
            <option value="Incapacidad">Incapacidad</option>
          </select>
          <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>

      </div>
    </div>
  </header>

  <div class="table-card" *ngIf="!loading; else loadingTemplate">
    
    <div class="table-responsive" *ngIf="reclamosFiltrados.length > 0; else emptyState">
      <table class="data-table">
        <thead>
          <tr>
            <th class="col-code">Ref.</th>
            <th class="col-client">Cliente</th>
            <th class="col-type">Tipo de Trámite</th>
            <th class="col-date">Ingreso</th>
            <th class="col-status">Estado</th>
            <th class="col-actions"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reclamo of reclamosFiltrados" [class.row-alert]="reclamo.path_revoca_patrocinio">
            
            <td class="col-code">
              <span class="code-badge">#{{ reclamo.codigo_seguimiento }}</span>
            </td>

            <td class="col-client">
              <div class="client-profile">
                <div class="avatar">{{ getIniciales(reclamo.nombre) }}</div>
                <div class="info">
                  <span class="name">{{ reclamo.nombre }}</span>
                  <span class="meta">DNI: {{ reclamo.dni }}</span>
                </div>
              </div>
            </td>

            <td class="col-type">
              <div class="type-info">
                <span class="main-type">{{ reclamo.tipo_tramite }}</span>
                <span class="sub-type" *ngIf="reclamo.subtipo_tramite">{{ reclamo.subtipo_tramite }}</span>
                
                <span *ngIf="reclamo.path_revoca_patrocinio" class="badge-alert">
                  REVOCACIÓN
                </span>
              </div>
            </td>

            <td class="col-date">
              <span class="date">{{ reclamo.fecha_creacion | date:'dd MMM yyyy' }}</span>
              <span class="time">{{ reclamo.fecha_creacion | date:'HH:mm' }} hs</span>
            </td>

            <td class="col-status">
              <span class="status-badge" [ngClass]="getClassEstado(reclamo.estado)">
                <span class="dot"></span> {{ reclamo.estado }}
              </span>
            </td>

            <td class="col-actions">
              <button class="btn-action" (click)="abrirModal(reclamo)" title="Ver Expediente">
                Gestionar
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
              </button>
            </td>

          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <div class="icon-box">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
        </div>
        <h3>Sin expedientes</h3>
        <p>No hay trámites que coincidan con los filtros aplicados.</p>
        <button class="btn-reset" (click)="resetFiltros()">Limpiar Filtros</button>
      </div>
    </ng-template>

  </div>

  <ng-template #loadingTemplate>
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Sincronizando expedientes...</p>
    </div>
  </ng-template>

</div>

<app-gestionar-reclamo-modal
  *ngIf="reclamoSeleccionado"
  [reclamo]="reclamoSeleccionado"
  (close)="cerrarModal()"
  (save)="guardarCambiosModal($event)"
></app-gestionar-reclamo-modal>