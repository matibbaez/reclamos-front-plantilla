<div class="page-wrapper">
  
  <header class="hero-section">
    <div class="hero-bg-pattern"></div>
    <div class="container hero-content">
      
      <ng-container *ngIf="isSubmitted; else introText">
        <div class="hero-status success">
          <div class="icon-bubble large">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          </div>
          <h1>¡Solicitud Recibida!</h1>
          <p>Tu trámite ha sido ingresado correctamente.</p>
        </div>
      </ng-container>

      <ng-template #introText>
        <div class="hero-status">
          <ng-container *ngIf="modoRevoca; else modoNormal">
            <h1>Cambio de Patrocinio</h1>
            <p>Gestionamos el traspaso de tu causa a <strong>{{ brand.nombre }}</strong>.</p>
          </ng-container>

          <ng-template #modoNormal>
            <h1 *ngIf="pasoActual === 0">Iniciar Nuevo Trámite</h1>
            <h1 *ngIf="pasoActual === 1">Completando Solicitud</h1>
            
            <p *ngIf="pasoActual === 0">Seleccioná la opción que describe tu caso.</p>
            <p *ngIf="pasoActual === 1">Trámite: <strong>{{ reclamoForm.get('tipo_tramite')?.value }}</strong></p>
          </ng-template>
        </div>
      </ng-template>

    </div>
  </header>

  <main class="main-container" [class.narrow]="isSubmitted">
    <div class="paper-card">

      <div class="alert-banner" *ngIf="modoRevoca && pasoActual === 0 && !isSubmitted">
        <div class="alert-content">
          <div class="icon-mini">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
          </div>
          <div>
            <strong>Modo Cambio de Abogado</strong>
            <span>Estás iniciando el proceso para revocar tu patrocinio anterior.</span>
          </div>
        </div>
        <button class="btn-text" (click)="cancelarModoRevoca()">Cancelar</button>
      </div>

      <div class="grid-options fade-in" *ngIf="!isSubmitted && pasoActual === 0">
        
        <button class="option-card" (click)="seleccionarTramite('Rechazo')">
          <div class="icon-box">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
          </div>
          <div class="text-content">
            <h3>Me rechazaron el accidente</h3>
            <p>La ART negó el siniestro mediante Carta Documento.</p>
          </div>
          <span class="fake-link">Seleccionar &rarr;</span>
        </button>

        <button class="option-card" (click)="seleccionarTramite('Medico')">
          <div class="icon-box">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
          </div>
          <div class="text-content">
            <h3>Alta Médica / Tratamiento</h3>
            <p>Disconformidad con el alta o falta de prestaciones.</p>
          </div>
          <span class="fake-link">Seleccionar &rarr;</span>
        </button>

        <button class="option-card" (click)="seleccionarTramite('Incapacidad')">
          <div class="icon-box">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          </div>
          <div class="text-content">
            <h3>Cobrar Indemnización</h3>
            <p>Tengo alta definitiva y quedaron secuelas.</p>
          </div>
          <span class="fake-link">Seleccionar &rarr;</span>
        </button>

        <button class="option-card" (click)="seleccionarTramite('Revoca')" *ngIf="!modoRevoca">
          <div class="icon-box">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" /></svg>
          </div>
          <div class="text-content">
            <h3>Cambiar de Abogado</h3>
            <p>Ya inicié con otro estudio pero quiero cambiar.</p>
          </div>
          <span class="fake-link">Seleccionar &rarr;</span>
        </button>

      </div>

      <div class="form-container fade-in" *ngIf="!isSubmitted && pasoActual === 1">
        
        <button class="btn-back" (click)="volverAStep1()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" /></svg>
          <span>Volver atrás</span>
        </button>

        <div class="info-card" *ngIf="pideFormularios">
          <div class="info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
          </div>
          <div class="info-body">
            <h4>Documentación Requerida</h4>
            <p>Descargá y firmá estos documentos para adjuntarlos:</p>
            <div class="download-links">
              <a href="formularios/Designacion.pdf" download class="chip-link">Designación de Patrocinio</a>
              <a href="formularios/Opcion.pdf" download class="chip-link">Opción de Jurisdicción</a>
            </div>
          </div>
        </div>

        <form [formGroup]="reclamoForm" (ngSubmit)="onSubmit()" class="main-form">

          <section class="form-section" *ngIf="reclamoForm.get('tipo_tramite')?.value === 'Medico'">
            <h3 class="section-title">Motivo Específico</h3>
            <div class="radio-group">
              <label class="radio-tile">
                <input type="radio" formControlName="subtipo_tramite" value="Div. Alta">
                <div class="tile-content">
                  <span class="tile-label">Rechazar Alta</span>
                  <small>Hace menos de 5 días</small>
                </div>
                <div class="check-indicator"></div>
              </label>
              
              <label class="radio-tile">
                <input type="radio" formControlName="subtipo_tramite" value="Reingreso">
                <div class="tile-content">
                  <span class="tile-label">Pedir Reingreso</span>
                  <small>Volvieron los dolores</small>
                </div>
                <div class="check-indicator"></div>
              </label>

              <label class="radio-tile">
                <input type="radio" formControlName="subtipo_tramite" value="Falta Prestaciones">
                <div class="tile-content">
                  <span class="tile-label">Falta Prestaciones</span>
                  <small>Traslados / Estudios</small>
                </div>
                <div class="check-indicator"></div>
              </label>
            </div>
          </section>

          <section class="form-section">
            <h3 class="section-title">Datos Personales</h3>
            <div class="form-grid">
              <div class="input-group">
                <label>Nombre Completo</label>
                <input type="text" formControlName="nombre" placeholder="Como figura en DNI">
              </div>
              <div class="input-group">
                <label>DNI</label>
                <input type="text" formControlName="dni" placeholder="Solo números">
              </div>
              <div class="input-group full">
                <label>Email</label>
                <input type="email" formControlName="email" placeholder="ejemplo@email.com">
              </div>
            </div>
          </section>

          <section class="form-section" *ngIf="pideCartaYTextos">
            <h3 class="section-title">Detalles Laborales</h3>
            <div class="form-grid">
              <div class="input-group">
                <label>Jornada Laboral</label>
                <input type="text" formControlName="jornada_laboral" placeholder="Ej: Lun a Vie 9 a 18">
              </div>
              <div class="input-group">
                <label>Dirección Laboral</label>
                <input type="text" formControlName="direccion_laboral" placeholder="Calle y Altura">
              </div>
              <div class="input-group full">
                <label>Trayecto Habitual</label>
                <textarea formControlName="trayecto_habitual" placeholder="Describí brevemente tu recorrido..."></textarea>
              </div>
            </div>
          </section>

          <section class="form-section">
            <h3 class="section-title">Archivos Adjuntos</h3>

            <div class="toggle-card">
              <div class="toggle-text">
                <strong>¿Ya tenés abogado?</strong>
                <p>Activalo si querés cambiar tu patrocinio a nosotros.</p>
              </div>
              <label class="switch">
                <input type="checkbox" formControlName="tiene_abogado_anterior">
                <span class="slider"></span>
              </label>
            </div>

            <div class="files-grid">
              <div class="file-upload-wrapper full danger-zone" *ngIf="reclamoForm.get('tiene_abogado_anterior')?.value">
                <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileRevoca')?.value">
                  <input type="file" (change)="onFileChange($event, 'fileRevoca')" accept=".pdf,.jpg,.png" hidden>
                  <div class="icon-slot">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                  </div>
                  <div class="text-slot">
                    <strong>{{ reclamoForm.get('fileRevoca')?.value?.name || 'Subir Carta de Revoca' }}</strong>
                  </div>
                  <div class="status-slot" *ngIf="reclamoForm.get('fileRevoca')?.value">✓</div>
                </label>
              </div>

              <div class="file-upload-wrapper">
                <label>DNI (Frente y Dorso)</label>
                <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileDNI')?.value">
                  <input type="file" (change)="onFileChange($event, 'fileDNI')" accept=".pdf,.jpg,.png" hidden>
                  
                  <div class="icon-slot">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0zm1.294 6.336a6.721 6.721 0 01-3.17.789 6.721 6.721 0 01-3.168-.789 3.376 3.376 0 016.338 0z" /></svg>
                  </div>
                  
                  <div class="text-slot">
                    <span class="filename">
                      {{ reclamoForm.get('fileDNI')?.value?.name || 'Tocar para adjuntar' }}
                    </span>
                    <span class="helper" *ngIf="!reclamoForm.get('fileDNI')?.value">PDF o Foto legible</span>
                  </div>

                  <div class="status-slot" *ngIf="reclamoForm.get('fileDNI')?.value">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 24px;"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
                  </div>
                </label>
              </div>

              <div class="file-upload-wrapper" *ngIf="pideAlta">
                <label>Alta Médica</label>
                <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileAlta')?.value">
                  <input type="file" (change)="onFileChange($event, 'fileAlta')" accept=".pdf,.jpg,.png" hidden>
                  <div class="icon-slot">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                  </div>
                  <div class="text-slot">
                    <span class="filename">{{ reclamoForm.get('fileAlta')?.value?.name || 'Seleccionar...' }}</span>
                  </div>
                  <div class="status-slot" *ngIf="reclamoForm.get('fileAlta')?.value">✓</div>
                </label>
              </div>

               <div class="file-upload-wrapper" *ngIf="pideRecibo">
                <label>Recibo de Sueldo</label>
                <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileRecibo')?.value">
                  <input type="file" (change)="onFileChange($event, 'fileRecibo')" accept=".pdf,.jpg,.png" hidden>
                  <div class="icon-slot">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  </div>
                  <div class="text-slot">
                    <span class="filename">{{ reclamoForm.get('fileRecibo')?.value?.name || 'Seleccionar...' }}</span>
                  </div>
                  <div class="status-slot" *ngIf="reclamoForm.get('fileRecibo')?.value">✓</div>
                </label>
              </div>

               <ng-container *ngIf="pideFormularios">
                <div class="file-upload-wrapper">
                  <label>Formulario 1</label>
                  <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileForm1')?.value">
                    <input type="file" (change)="onFileChange($event, 'fileForm1')" accept=".pdf,.jpg,.png" hidden>
                    <div class="icon-slot">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                    </div>
                    <div class="text-slot"><span class="filename">{{ reclamoForm.get('fileForm1')?.value?.name || 'Subir...' }}</span></div>
                    <div class="status-slot" *ngIf="reclamoForm.get('fileForm1')?.value">✓</div>
                  </label>
                </div>
                <div class="file-upload-wrapper">
                  <label>Formulario 2</label>
                  <label class="file-dropzone" [class.uploaded]="reclamoForm.get('fileForm2')?.value">
                    <input type="file" (change)="onFileChange($event, 'fileForm2')" accept=".pdf,.jpg,.png" hidden>
                    <div class="icon-slot">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                    </div>
                    <div class="text-slot"><span class="filename">{{ reclamoForm.get('fileForm2')?.value?.name || 'Subir...' }}</span></div>
                    <div class="status-slot" *ngIf="reclamoForm.get('fileForm2')?.value">✓</div>
                  </label>
                </div>
               </ng-container>

               <div class="file-upload-wrapper full danger-zone" *ngIf="pideCartaYTextos">
                <label>Carta Documento</label>
                <label class="file-dropzone danger" [class.uploaded]="reclamoForm.get('fileCartaDocumento')?.value">
                  <input type="file" (change)="onFileChange($event, 'fileCartaDocumento')" accept=".pdf,.jpg,.png" hidden>
                  <div class="icon-slot">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
                  </div>
                  <div class="text-slot">
                    <strong>{{ reclamoForm.get('fileCartaDocumento')?.value?.name || 'Adjuntar Carta Doc.' }}</strong>
                  </div>
                  <div class="status-slot" *ngIf="reclamoForm.get('fileCartaDocumento')?.value">✓</div>
                </label>
              </div>

            </div>
          </section>

          <div class="form-actions">
            <button type="submit" class="btn btn-warning" [disabled]="reclamoForm.invalid || isLoading">
              <span *ngIf="!isLoading">CONFIRMAR TRÁMITE</span>
              <span class="loader" *ngIf="isLoading"></span>
            </button>
            <p class="legal-text">Nuestros abogados revisarán tu caso sin cargo.</p>
          </div>

        </form>
      </div>

      <div class="success-content fade-in" *ngIf="isSubmitted">
        <div class="ticket-box">
          <span class="ticket-title">CÓDIGO DE SEGUIMIENTO</span>
          <div class="code-display" (click)="copiarCodigo()">
            {{ codigoExito }}
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18a2.25 2.25 0 01-2.25 2.25H6.75a2.25 2.25 0 01-2.25-2.25V6.75a2.25 2.25 0 012.25-2.25H6.75a2.25 2.25 0 012.25 2.25v.75m0 0v4.5m0-4.5h.008v.008H6.75V12m9.75 0h.008v.008H16.5V12z" /></svg>
            </button>
          </div>
          <p>Guardá este código para consultar el estado.</p>
        </div>
        <button class="btn btn-secondary" (click)="iniciarOtroReclamo()">Iniciar otro trámite</button>
      </div>

    </div>
  </main>
</div>